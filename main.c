/* Copyright 2014, Kenneth MacKay. Licensed under the BSD 2-clause license. */

#include "uECC.h"

#include <stdio.h>
#include <string.h>
#include <stdbool.h>
#include "sha256.h"
#include "driverlib/sysctl.h"
#include "driverlib/timer.h"
#include "inc/hw_ints.h"
#include "inc/hw_memmap.h"


void init_timer()
{
    SysCtlPeripheralEnable(SYSCTL_PERIPH_TIMER0);
    TimerConfigure(TIMER0_BASE, TIMER_CFG_ONE_SHOT | TIMER_CFG_A_ONE_SHOT);
    TimerControlStall(TIMER0_BASE, TIMER_A, true);
    TimerLoadSet(TIMER0_BASE, TIMER_A, ~0);
    TimerEnable(TIMER0_BASE, TIMER_A);
}

int main() {
    int i, c;
    uint8_t private[32] = {0};
    uint8_t public[64] = {0x20,0x9A,0x5B,0x44,0x89,0x07,0xDB,0x02,0xEF,0x0E,0x55,0x64,0xC6,0x72,0x74,0xE5,0x4A,0xD6,0x78,0x08,0x38,0x64,0xCC,0x9B,0xB5,0x22,0x6B,0x8F,0x33,0x4D,0x3D,0xFE,0xCC,0xC6,0xD8,0x47,0x0F,0x5F,0x36,0xE2,0x6E,0x84,0x96,0xC8,0xF7,0xAE,0xEA,0x48,0x4F,0x59,0x88,0x98,0xBC,0xC3,0x54,0x0F,0xCB,0x54,0xC9,0x7D,0x8C,0xD0,0x6B,0x39};
    //0x58,0xbb,0x11,0x9c,0x35,0x51,0x3a,0x45,0x1d,0x24,0xdc,0x20,0xef,0x0e,0x90,0x31,0xec,0x85,0xb3,0x5b,0xfc,0x91,0x9d,0x26,0x3e,0x7e,0x5d,0x98,0x68,0x90,0x9c,0xb5
    uint8_t hash[32] = {0};

    uint8_t msg[] = "AA";

    uint8_t sig[64] = {0xB1,0x24,0x86,0x40,0xDF,0xCB,0x53,0x99,0x07,0x6B,0x99,0xCC,0xDE,0xED,0x0F,0xA4,0xBF,0xC1,0x7B,0x8B,0x7F,0xA9,0x92,0x48,0x9C,0xFD,0xD1,0xE3,0x8E,0x09,0x43,0x9C,0x15,0x38,0x99,0xA6,0x34,0x15,0xA2,0x4A,0x03,0xCC,0x9E,0x40,0xCE,0xF3,0xFA,0x20,0x19,0x1F,0x2F,0x5A,0x8D,0xC9,0x6D,0x2C,0x91,0xA3,0x1B,0x6E,0x58,0x9F,0x91,0xA3};


    const struct uECC_Curve_t * curve =  uECC_secp256r1();

    calc_sha_256(hash , msg , 2);

    for (i = 0; i < 256; ++i) {

        if (!uECC_verify(public, hash, sizeof(hash), sig, curve)) {
            return 1;
        }

    }


    return 0;
}
